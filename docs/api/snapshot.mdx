---
id: snapshot
title: Snapshot
sidebar_position: 5
---

import { Camera, MapPin, Package, Search, ClipboardList, Lightbulb, Link } from 'lucide-react';

# Snapshot - Kompletn√≠ stav za≈ô√≠zen√≠

## Z√≠sk√°n√≠ √∫pln√©ho obrazu v≈°ech senzor≈Ø a nastaven√≠

---

## <MapPin size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Endpoint

```
GET /admin-panel/v1/external/history/snapshot/{deviceId}
```

### Parametry
- **deviceId** (string, povinn√Ω) - Identifik√°tor va≈°eho za≈ô√≠zen√≠
- **timestamp** (string, voliteln√Ω) - ƒåasov√© raz√≠tko pro historick√Ω snapshot

import ApiExplorer from '@site/src/components/ApiExplorer/ApiExplorer';

<ApiExplorer
  endpoint="/external/history/snapshot/{deviceId}"
  method="GET"
  title="Z√≠skat Snapshot za≈ô√≠zen√≠"
  description="Z√≠skejte kompletn√≠ snapshot v≈°ech senzor≈Ø, stav≈Ø a nastaven√≠ va≈°eho za≈ô√≠zen√≠. Tento endpoint poskytuje nejdetailnƒõj≈°√≠ pohled na aktu√°ln√≠ stav za≈ô√≠zen√≠."
  requiresAuth={true}
  defaultDeviceId={true}
  parameters={[
    {
      name: "deviceId",
      type: "path",
      required: true,
      description: "Jedineƒçn√Ω identifik√°tor za≈ô√≠zen√≠ (automaticky se naƒçte seznam va≈°ich za≈ô√≠zen√≠)",
      example: "qfeb-od13-ul2c-sgrl"
    },
    {
      name: "timestamp",
      type: "query",
      required: false,
      description: "ƒåasov√© raz√≠tko pro historick√Ω snapshot (ISO 8601 form√°t)",
      example: "2025-01-29T10:00:00Z"
    }
  ]}
  responseExample={{
    "status": 1,
    "data": [
      {
        "id": "qfeb-od13-ul2c-sgrl",
        "name": "MyBox Home",
        "firmwareVersion": "7",
        "firmwareName": "1.6.1-7",
        "state": "ready",
        "nodes": [
          {
            "formattedId": "ac-module-V1",
            "id": "ac-module",
            "sensors": [
              {
                "id": "evse-state",
                "value": "Unplugged"
              },
              {
                "id": "car-state",
                "value": "STATE A"
              },
              {
                "id": "max-charge-current",
                "value": "32"
              }
            ]
          },
          {
            "id": "ev-meter",
            "sensors": [
              {
                "id": "ev-meter-energy",
                "value": "2661.43"
              },
              {
                "id": "ev-meter-power",
                "value": "0.00"
              }
            ]
          }
        ]
      }
    ]
  }}
/>

---

## <Package size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Struktura odpovƒõdi

Snapshot poskytuje **nejkompletnƒõj≈°√≠ data** ze v≈°ech endpoint≈Ø - obsahuje V≈†ECHNY senzory, nastaven√≠ a stavy.

```json
{
  "data": [
    {
      "id": "abc1-def2-ghi3-jkl4",
      "name": "Nab√≠jeƒçka 1",
      "firmwareVersion": "7",
      "firmwareName": "1.6.1-7",
      "state": "ready",
      "nodes": [...]
    }
  ]
}
```

---

## <Search size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Struktura Node (modulu)

Ka≈æd√Ω node obsahuje skupinu souvisej√≠c√≠ch senzor≈Ø:

```json
{
  "formattedId": "ac-module-V1",
  "id": "ac-module",
  "rootTopic": "ac-module/automatic-session-end",
  "sensors": [...],
  "options": [],
  "telemetry": []
}
```

---

## <ClipboardList size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Hlavn√≠ moduly (nodes) a jejich senzory

### **AC-Module** - Nab√≠jec√≠ modul
Nejd≈Øle≈æitƒõj≈°√≠ modul pro sledov√°n√≠ nab√≠jen√≠.

```json
{
  "id": "ac-module",
  "sensors": [
    {
      "id": "evse-state",
      "value": "Unplugged"  // Stav konektoru
    },
    {
      "id": "car-state", 
      "value": "STATE A"  // Stav vozidla
    },
    {
      "id": "max-charge-current",
      "value": "32"  // Max nab√≠jec√≠ proud (A)
    },
    {
      "id": "cable-type",
      "value": "Fixed32"  // Typ kabelu
    },
    {
      "id": "cable-locked",
      "value": "false"  // Z√°mek kabelu
    },
    {
      "id": "pwm-on",
      "value": "false"  // PWM sign√°l aktivn√≠
    }
  ]
}
```

**Kl√≠ƒçov√© hodnoty:**
- `evse-state` - Unplugged/Plugged/Charging/Error
- `car-state` - STATE A/B/C/PAUSE/FAIL
- `max-cb-current` - Jistiƒç (16A, 25A, 32A...)
- `nlb-node-current` - Aktu√°ln√≠ proud

---

### üìä **EV-Meter** - Elektromƒõr
Mƒõ≈ôen√≠ spot≈ôeby energie a v√Ωkonu.

```json
{
  "id": "ev-meter",
  "sensors": [
    {
      "id": "ev-meter-energy",
      "value": "2661.43"  // Celkov√° energie (kWh)
    },
    {
      "id": "ev-meter-power",
      "value": "0.00"  // Aktu√°ln√≠ v√Ωkon (kW)
    },
    {
      "id": "ev-meter-current-l1",
      "value": "0.02"  // Proud f√°ze L1 (A)
    },
    {
      "id": "ev-meter-current-l2",
      "value": "0.00"  // Proud f√°ze L2 (A)
    },
    {
      "id": "ev-meter-current-l3",
      "value": "4.08"  // Proud f√°ze L3 (A)
    }
  ]
}
```

**Hodnoty po f√°z√≠ch:**
- `ev-meter-energy-l1/l2/l3` - Energie na f√°zi (kWh)
- `ev-meter-power-l1/l2/l3` - V√Ωkon na f√°zi (kW)
- `ev-meter-current-l1/l2/l3` - Proud na f√°zi (A)

---

### üå°Ô∏è **Temp-block** - Teplotn√≠ senzory
Sledov√°n√≠ teplot kritick√Ωch komponent.

```json
{
  "id": "temp-block",
  "sensors": [
    {
      "id": "temp-amb",
      "value": "25.3"  // Okoln√≠ teplota (¬∞C)
    },
    {
      "id": "temp-evse",
      "value": "32.1"  // Teplota EVSE modulu (¬∞C)
    },
    {
      "id": "temp-mcu",
      "value": "45.2"  // Teplota procesoru (¬∞C)
    }
  ]
}
```

---

### üì° **Control-pilot** - Komunikace s vozidlem
PWM sign√°ly pro komunikaci s elektromobilem.

```json
{
  "id": "control-pilot",
  "sensors": [
    {
      "id": "cp-car-state",
      "value": "STATE A"
    },
    {
      "id": "cp-high",
      "value": "11980"  // Vysok√° √∫rove≈à PWM (mV)
    },
    {
      "id": "cp-low",
      "value": "-11980"  // N√≠zk√° √∫rove≈à PWM (mV)
    },
    {
      "id": "cp-max-current",
      "value": "32"  // Max povolen√Ω proud (A)
    }
  ]
}
```

---

### üîã **Session** - Nab√≠jec√≠ relace
Informace o aktu√°ln√≠ nab√≠jec√≠ relaci.

```json
{
  "id": "session",
  "sensors": [
    {
      "id": "session-meter-energy-start",
      "value": "2650.12"  // Stav elektromƒõru na zaƒç√°tku (kWh)
    },
    {
      "id": "session-price",
      "value": "65.50"  // Cena relace (Kƒç)
    },
    {
      "id": "session-duration",
      "value": "3600"  // D√©lka relace (s)
    },
    {
      "id": "session-energy-used",
      "value": "11.31"  // Nabito energie (kWh)
    }
  ]
}
```

---

## <Lightbulb size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Praktick√© vyu≈æit√≠ snapshot dat

### Kompletn√≠ monitoring stavu

```javascript
async function getCompleteStatus(deviceId) {
  const snapshot = await fetchSnapshot(deviceId);
  const device = snapshot.data[0];
  
  // Naj√≠t AC modul
  const acModule = device.nodes.find(n => n.id === 'ac-module');
  const evseState = acModule.sensors.find(s => s.id === 'evse-state');
  
  // Naj√≠t elektromƒõr
  const evMeter = device.nodes.find(n => n.id === 'ev-meter');
  const power = evMeter.sensors.find(s => s.id === 'ev-meter-power');
  
  return {
    state: evseState.value,
    power: parseFloat(power.value),
    timestamp: new Date()
  };
}
```

### Export v≈°ech senzor≈Ø do CSV

```python
import csv
import json

def export_snapshot_to_csv(snapshot_data, filename):
    with open(filename, 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(['Module', 'Sensor', 'Value', 'Unit'])
        
        for node in snapshot_data['nodes']:
            for sensor in node.get('sensors', []):
                writer.writerow([
                    node['id'],
                    sensor['id'],
                    sensor.get('value', ''),
                    sensor.get('unit', '')
                ])
```

### Detekce zmƒõn stavu

```javascript
let previousSnapshot = null;

async function detectChanges(deviceId) {
  const currentSnapshot = await fetchSnapshot(deviceId);
  
  if (previousSnapshot) {
    // Porovnat hodnoty
    const changes = compareSnapshots(previousSnapshot, currentSnapshot);
    
    if (changes.length > 0) {
      console.log('Detekovan√© zmƒõny:', changes);
      // Poslat notifikaci, ulo≈æit do DB, atd.
    }
  }
  
  previousSnapshot = currentSnapshot;
}

// Spustit ka≈æd√Ωch 30 sekund
setInterval(() => detectChanges('device-id'), 30000);
```

---

## ‚ö†Ô∏è D≈Øle≈æit√© pozn√°mky

:::warning Form√°t hodnot
V≈°echny hodnoty v snapshot jsou typu **string**. V≈ædy je p≈ôev√°dƒõjte na spr√°vn√Ω datov√Ω typ:
```javascript
const power = parseFloat(sensor.value);  // Pro desetinn√° ƒç√≠sla
const state = sensor.value === 'true';   // Pro boolean
```
:::

:::tip Optimalizace
Snapshot obsahuje hodnƒõ dat. Pro bƒõ≈æn√Ω monitoring pou≈æ√≠vejte radƒõji [Live Data](./live-data) endpoint, kter√Ω je rychlej≈°√≠.
:::

---

## <Search size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Snapshot konkr√©tn√≠ho nodu

```
GET /external/history/snapshot/{deviceId}/{nodeId}
```

Z√≠sk√° historick√Ω snapshot konkr√©tn√≠ho nodu v za≈ô√≠zen√≠. U≈æiteƒçn√© pro detailn√≠ anal√Ωzu jednotliv√Ωch komponent.

### Parametry
- `deviceId` - ID za≈ô√≠zen√≠
- `nodeId` - ID nodu (nap≈ô. `ac-measurement`, `reports`, `control`)
- `from` - Zaƒç√°tek obdob√≠ (ISO 8601)
- `to` - Konec obdob√≠ (ISO 8601)

### P≈ô√≠klad odpovƒõdi - AC Sensor node "ac-measurement"

```json
{
  "data": [{
    "node": {
      "formattedId": "ac-measurement-V1",
      "id": "ac-measurement",
      "rootTopic": "ac-measurement/ac-current-1",
      "sensors": [
        {
          "id": "ac-current-1",
          "value": "0.00",
          "rootTopic": "ac-measurement/ac-current-1"
        },
        {
          "id": "ac-current-2",
          "value": "0.57",
          "rootTopic": "ac-measurement/ac-current-2"
        },
        {
          "id": "ac-current-3",
          "value": "6.27",
          "rootTopic": "ac-measurement/ac-current-3"
        },
        {
          "id": "ac-phase-connection",
          "value": "L1",
          "rootTopic": "ac-measurement/ac-phase-connection"
        },
        {
          "id": "distribution-system",
          "value": "4-wire",
          "rootTopic": "ac-measurement/distribution-system"
        }
      ],
      "options": [],
      "telemetry": []
    },
    "owner": {
      "id": 1694444441651503,
      "email": "user@example.com",
      "first_name": "John",
      "last_name": "Doe"
    }
  }],
  "status": 1
}
```

### P≈ô√≠klad pou≈æit√≠ - Python

```python
import requests
from requests.auth import HTTPBasicAuth
from datetime import datetime, timedelta

def get_node_snapshot(device_id, node_id, hours_back=24):
    """Z√≠sk√° historick√Ω snapshot konkr√©tn√≠ho nodu"""

    API_URL = "https://cloud.mybox.pro/admin-panel/v1/external"

    to_date = datetime.now()
    from_date = to_date - timedelta(hours=hours_back)

    response = requests.get(
        f"{API_URL}/history/snapshot/{device_id}/{node_id}",
        params={
            'from': from_date.isoformat() + 'Z',
            'to': to_date.isoformat() + 'Z'
        },
        auth=HTTPBasicAuth(API_KEY, API_SECRET)
    )

    if response.status_code == 200:
        data = response.json()
        if data['data']:
            node_data = data['data'][0]['node']

            # Zpracuj senzory
            sensors = {}
            for sensor in node_data.get('sensors', []):
                sensors[sensor['id']] = sensor['value']

            return {
                'node_id': node_data['id'],
                'sensors': sensors,
                'telemetry': node_data.get('telemetry', []),
                'options': node_data.get('options', [])
            }

    return None

# Pou≈æit√≠
snapshot = get_node_snapshot('device-xxx', 'ac-measurement')
if snapshot:
    print(f"Node: {snapshot['node_id']}")
    print(f"AC Current L1: {snapshot['sensors'].get('ac-current-1', 'N/A')} A")
    print(f"AC Current L2: {snapshot['sensors'].get('ac-current-2', 'N/A')} A")
    print(f"AC Current L3: {snapshot['sensors'].get('ac-current-3', 'N/A')} A")
```

### Use cases pro node snapshots

1. **DLM monitoring** - Sledov√°n√≠ jednotliv√Ωch modul≈Ø v DLM syst√©mu
2. **Detailn√≠ diagnostika** - Anal√Ωza specifick√Ωch komponent
3. **Porovn√°n√≠ stav≈Ø** - Srovn√°n√≠ r≈Øzn√Ωch nod≈Ø nebo ƒçasov√Ωch obdob√≠
4. **Audit zmƒõn** - Sledov√°n√≠ zmƒõn v konfiguraci nod≈Ø

---

## <Link size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Souvisej√≠c√≠ endpointy

- [Live Data](./live-data) - Rychlej≈°√≠ endpoint pro aktu√°ln√≠ data
- [Telemetrie](./telemetry) - Historie konkr√©tn√≠ch hodnot
- [Informace o za≈ô√≠zen√≠](./devices) - Z√°kladn√≠ informace
- [Node-level Monitoring](./node-level-monitoring) - Kompletn√≠ dokumentace pro pr√°ci s nody