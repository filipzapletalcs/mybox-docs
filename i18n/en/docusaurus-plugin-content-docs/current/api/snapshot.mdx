---
id: snapshot
title: Snapshot
sidebar_position: 5
---

import { Camera, MapPin, Package, Search, ClipboardList, Lightbulb, Link } from 'lucide-react';

# Snapshot - Complete Device State

## Get Complete Picture of All Sensors and Settings

---

## <MapPin size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Endpoint

```
GET /admin-panel/v1/external/history/snapshot/{deviceId}
```

### Parameters
- **deviceId** (string, required) - Your device identifier
- **timestamp** (string, optional) - Timestamp for historical snapshot

import ApiExplorer from '@site/src/components/ApiExplorer/ApiExplorer';

<ApiExplorer
  endpoint="/external/history/snapshot/{deviceId}"
  method="GET"
  title="Get Device Snapshot"
  description="Get a complete snapshot of all sensors, states, and settings of your device. This endpoint provides the most detailed view of the current device state."
  requiresAuth={true}
  defaultDeviceId={true}
  parameters={[
    {
      name: "deviceId",
      type: "path",
      required: true,
      description: "Unique device identifier (your device list will be loaded automatically)",
      example: "qfeb-od13-ul2c-sgrl"
    },
    {
      name: "timestamp",
      type: "query",
      required: false,
      description: "Timestamp for historical snapshot (ISO 8601 format)",
      example: "2025-01-29T10:00:00Z"
    }
  ]}
  responseExample={{
    "status": 1,
    "data": [
      {
        "id": "qfeb-od13-ul2c-sgrl",
        "name": "MyBox Home",
        "firmwareVersion": "7",
        "firmwareName": "1.6.1-7",
        "state": "ready",
        "nodes": [
          {
            "formattedId": "ac-module-V1",
            "id": "ac-module",
            "sensors": [
              {
                "id": "evse-state",
                "value": "Unplugged"
              },
              {
                "id": "car-state",
                "value": "STATE A"
              },
              {
                "id": "max-charge-current",
                "value": "32"
              }
            ]
          },
          {
            "id": "ev-meter",
            "sensors": [
              {
                "id": "ev-meter-energy",
                "value": "2661.43"
              },
              {
                "id": "ev-meter-power",
                "value": "0.00"
              }
            ]
          }
        ]
      }
    ]
  }}
/>

---

## <Package size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Response Structure

Snapshot provides **the most comprehensive data** of all endpoints - it contains ALL sensors, settings, and states.

```json
{
  "data": [
    {
      "id": "abc1-def2-ghi3-jkl4",
      "name": "Charger 1",
      "firmwareVersion": "7",
      "firmwareName": "1.6.1-7",
      "state": "ready",
      "nodes": [...]
    }
  ]
}
```

---

## <Search size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Node (Module) Structure

Each node contains a group of related sensors:

```json
{
  "formattedId": "ac-module-V1",
  "id": "ac-module",
  "rootTopic": "ac-module/automatic-session-end",
  "sensors": [...],
  "options": [],
  "telemetry": []
}
```

---

## <ClipboardList size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Main Modules (nodes) and Their Sensors

### **AC-Module** - Charging Module
The most important module for charging monitoring.

```json
{
  "id": "ac-module",
  "sensors": [
    {
      "id": "evse-state",
      "value": "Unplugged"  // Connector state
    },
    {
      "id": "car-state",
      "value": "STATE A"  // Vehicle state
    },
    {
      "id": "max-charge-current",
      "value": "32"  // Max charging current (A)
    },
    {
      "id": "cable-type",
      "value": "Fixed32"  // Cable type
    },
    {
      "id": "cable-locked",
      "value": "false"  // Cable lock
    },
    {
      "id": "pwm-on",
      "value": "false"  // PWM signal active
    }
  ]
}
```

**Key Values:**
- `evse-state` - Unplugged/Plugged/Charging/Error
- `car-state` - STATE A/B/C/PAUSE/FAIL
- `max-cb-current` - Circuit breaker (16A, 25A, 32A...)
- `nlb-node-current` - Current amperage

---

### **EV-Meter** - Electric Meter
Energy consumption and power measurement.

```json
{
  "id": "ev-meter",
  "sensors": [
    {
      "id": "ev-meter-energy",
      "value": "2661.43"  // Total energy (kWh)
    },
    {
      "id": "ev-meter-power",
      "value": "0.00"  // Current power (kW)
    },
    {
      "id": "ev-meter-current-l1",
      "value": "0.02"  // Phase L1 current (A)
    },
    {
      "id": "ev-meter-current-l2",
      "value": "0.00"  // Phase L2 current (A)
    },
    {
      "id": "ev-meter-current-l3",
      "value": "4.08"  // Phase L3 current (A)
    }
  ]
}
```

**Phase Values:**
- `ev-meter-energy-l1/l2/l3` - Phase energy (kWh)
- `ev-meter-power-l1/l2/l3` - Phase power (kW)
- `ev-meter-current-l1/l2/l3` - Phase current (A)

---

### **Temp-block** - Temperature Sensors
Critical component temperature monitoring.

```json
{
  "id": "temp-block",
  "sensors": [
    {
      "id": "temp-amb",
      "value": "25.3"  // Ambient temperature (°C)
    },
    {
      "id": "temp-evse",
      "value": "32.1"  // EVSE module temperature (°C)
    },
    {
      "id": "temp-mcu",
      "value": "45.2"  // Processor temperature (°C)
    }
  ]
}
```

---

### **Control-pilot** - Vehicle Communication
PWM signals for electric vehicle communication.

```json
{
  "id": "control-pilot",
  "sensors": [
    {
      "id": "cp-car-state",
      "value": "STATE A"
    },
    {
      "id": "cp-high",
      "value": "11980"  // High PWM level (mV)
    },
    {
      "id": "cp-low",
      "value": "-11980"  // Low PWM level (mV)
    },
    {
      "id": "cp-max-current",
      "value": "32"  // Max allowed current (A)
    }
  ]
}
```

---

### **Session** - Charging Session
Information about the current charging session.

```json
{
  "id": "session",
  "sensors": [
    {
      "id": "session-meter-energy-start",
      "value": "2650.12"  // Meter state at start (kWh)
    },
    {
      "id": "session-price",
      "value": "65.50"  // Session price (CZK)
    },
    {
      "id": "session-duration",
      "value": "3600"  // Session duration (s)
    },
    {
      "id": "session-energy-used",
      "value": "11.31"  // Energy charged (kWh)
    }
  ]
}
```

---

## <Lightbulb size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Practical Use of Snapshot Data

### Complete Status Monitoring

```javascript
async function getCompleteStatus(deviceId) {
  const snapshot = await fetchSnapshot(deviceId);
  const device = snapshot.data[0];

  // Find AC module
  const acModule = device.nodes.find(n => n.id === 'ac-module');
  const evseState = acModule.sensors.find(s => s.id === 'evse-state');

  // Find electric meter
  const evMeter = device.nodes.find(n => n.id === 'ev-meter');
  const power = evMeter.sensors.find(s => s.id === 'ev-meter-power');

  return {
    state: evseState.value,
    power: parseFloat(power.value),
    timestamp: new Date()
  };
}
```

### Export All Sensors to CSV

```python
import csv
import json

def export_snapshot_to_csv(snapshot_data, filename):
    with open(filename, 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(['Module', 'Sensor', 'Value', 'Unit'])

        for node in snapshot_data['nodes']:
            for sensor in node.get('sensors', []):
                writer.writerow([
                    node['id'],
                    sensor['id'],
                    sensor.get('value', ''),
                    sensor.get('unit', '')
                ])
```

### State Change Detection

```javascript
let previousSnapshot = null;

async function detectChanges(deviceId) {
  const currentSnapshot = await fetchSnapshot(deviceId);

  if (previousSnapshot) {
    // Compare values
    const changes = compareSnapshots(previousSnapshot, currentSnapshot);

    if (changes.length > 0) {
      console.log('Detected changes:', changes);
      // Send notification, save to DB, etc.
    }
  }

  previousSnapshot = currentSnapshot;
}

// Run every 30 seconds
setInterval(() => detectChanges('device-id'), 30000);
```

---

## Important Notes

:::warning Value Format
All values in snapshot are of type **string**. Always convert them to the correct data type:
```javascript
const power = parseFloat(sensor.value);  // For decimal numbers
const state = sensor.value === 'true';   // For boolean
```
:::

:::tip Optimization
Snapshot contains a lot of data. For regular monitoring, use the [Live Data](./live-data) endpoint instead, which is faster.
:::

---

## <Search size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Snapshot of Specific Node

```
GET /external/history/snapshot/{deviceId}/{nodeId}
```

Gets historical snapshot of a specific node in the device. Useful for detailed analysis of individual components.

### Parameters
- `deviceId` - Device ID
- `nodeId` - Node ID (e.g., `ac-measurement`, `reports`, `control`)
- `from` - Period start (ISO 8601)
- `to` - Period end (ISO 8601)

### Example Response - AC Sensor node "ac-measurement"

```json
{
  "data": [{
    "node": {
      "formattedId": "ac-measurement-V1",
      "id": "ac-measurement",
      "rootTopic": "ac-measurement/ac-current-1",
      "sensors": [
        {
          "id": "ac-current-1",
          "value": "0.00",
          "rootTopic": "ac-measurement/ac-current-1"
        },
        {
          "id": "ac-current-2",
          "value": "0.57",
          "rootTopic": "ac-measurement/ac-current-2"
        },
        {
          "id": "ac-current-3",
          "value": "6.27",
          "rootTopic": "ac-measurement/ac-current-3"
        },
        {
          "id": "ac-phase-connection",
          "value": "L1",
          "rootTopic": "ac-measurement/ac-phase-connection"
        },
        {
          "id": "distribution-system",
          "value": "4-wire",
          "rootTopic": "ac-measurement/distribution-system"
        }
      ],
      "options": [],
      "telemetry": []
    },
    "owner": {
      "id": 1694444441651503,
      "email": "user@example.com",
      "first_name": "John",
      "last_name": "Doe"
    }
  }],
  "status": 1
}
```

### Example Usage - Python

```python
import requests
from requests.auth import HTTPBasicAuth
from datetime import datetime, timedelta

def get_node_snapshot(device_id, node_id, hours_back=24):
    """Get historical snapshot of a specific node"""

    API_URL = "https://cloud.mybox.pro/admin-panel/v1/external"

    to_date = datetime.now()
    from_date = to_date - timedelta(hours=hours_back)

    response = requests.get(
        f"{API_URL}/history/snapshot/{device_id}/{node_id}",
        params={
            'from': from_date.isoformat() + 'Z',
            'to': to_date.isoformat() + 'Z'
        },
        auth=HTTPBasicAuth(API_KEY, API_SECRET)
    )

    if response.status_code == 200:
        data = response.json()
        if data['data']:
            node_data = data['data'][0]['node']

            # Process sensors
            sensors = {}
            for sensor in node_data.get('sensors', []):
                sensors[sensor['id']] = sensor['value']

            return {
                'node_id': node_data['id'],
                'sensors': sensors,
                'telemetry': node_data.get('telemetry', []),
                'options': node_data.get('options', [])
            }

    return None

# Usage
snapshot = get_node_snapshot('device-xxx', 'ac-measurement')
if snapshot:
    print(f"Node: {snapshot['node_id']}")
    print(f"AC Current L1: {snapshot['sensors'].get('ac-current-1', 'N/A')} A")
    print(f"AC Current L2: {snapshot['sensors'].get('ac-current-2', 'N/A')} A")
    print(f"AC Current L3: {snapshot['sensors'].get('ac-current-3', 'N/A')} A")
```

### Use Cases for Node Snapshots

1. **DLM Monitoring** - Monitor individual modules in DLM system
2. **Detailed Diagnostics** - Analyze specific components
3. **State Comparison** - Compare different nodes or time periods
4. **Change Auditing** - Track changes in node configuration

---

## <Link size={20} style={{display: 'inline', verticalAlign: 'middle', marginRight: '0.5rem'}} color="var(--ifm-color-primary)" /> Related Endpoints

- [Live Data](./live-data) - Faster endpoint for current data
- [Telemetry](./telemetry) - History of specific values
- [Device Information](./devices) - Basic information
- [Node-level Monitoring](./node-level-monitoring) - Complete documentation for working with nodes
